<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEMO</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
    <style>
        #wrapper { display: flex; }
        #listPage { width: 200px; border-right: 1px solid #000; padding-right: 10px; }
        #mainPage { padding-left: 10px; }
    </style>
</head>
<body>
    <div id="wrapper">
        <h1>MEMO v 0.1</h1>
        <p id="add">
            <input id="addTitle" type="text" placeholder="title"/>
            <input id="addContent" type="text" placeholder="content"/>
            <input id="addBtn" type="button" value="add"/>
        </p>
        
        <div id="content">
            <div id="listPage">
                <ul id="list">
                    <!-- 메모 목록이 여기 추가됩니다 -->
                </ul>
            </div>

            <div id="mainPage">
                <p id="h1Text"></p>
                <p id="h2Text"></p>
                <p id="h3Text"></p>
            </div>
        </div>
    </div>

    <script>
        $(function() {
            // Initialize memo list on page load
            printMemoList();

            //제목과 내용을 입력하고 등록 버튼 누르면 메모 객체 생성해서 addMemo 호출
            $("#addBtn").click(function() {
                const memoObj = {
                    subject: $("#addTitle").val(),
                    content: $("#addContent").val(),
                    regdate: newDate(Date.now())
                };
                addMemo(memoObj);
                $("#addTitle").val('');
                $("#addContent").val('');
            });

            // delete 버튼을 눌렀을 때
            $(document).on('click', '.deleteBtn', function() {
                const memoId = $(this).parent().attr("id").substr(4);
                removeMemo(memoId);
            });

            // 리스트를 클릭했을 때 오른쪽에 내용이 보일 수 있게 하기
            $(document).on('click', '#list li', function() {
                const memoId = $(this).attr("id").substr(4);
                const memoList = getMemoList();
                const memo = memoList[memoId];
                $("#h1Text").text(memo.regdate);
                $("#h2Text").text(memo.subject);
                $("#h3Text").text(memo.content);
            });

            // 날짜 포맷
            function newDate(regdate) {
                return moment(regdate).format("YYYY.MM.DD HH:mm");
            }

            // localStorage의 메모리스트를 가져오는 함수
            function getMemoList() {
                let memoList = localStorage.getItem("memoList");
                if (memoList == null || memoList == "") {
                    localStorage.setItem("memoList", "[]");
                    return [];
                } else {
                    return JSON.parse(memoList);
                }
            }

            // localStorage에 메모 객체를 저장하는 함수
            function addMemo(memoObj) {
                const memoListArr = getMemoList();
                memoListArr.push(memoObj);  // 배열에 새 메모 추가
                localStorage.setItem("memoList", JSON.stringify(memoListArr));  // JSON.stringify() 호출 수정
                printMemoList();
            }

            // localStorage의 메모리스트에서 메모를 삭제하는 함수
            function removeMemo(key) {
                const memoListArr = getMemoList();
                memoListArr.splice(key, 1);  // 배열에서 특정 인덱스의 메모 제거
                localStorage.setItem("memoList", JSON.stringify(memoListArr));  // JSON.stringify() 호출 수정
                printMemoList();
            }

            // 최신 메모를 content에 보여주는 함수
            function printMemoList() {
                $("#list").empty();
                const memoList = getMemoList();
                const memoListLeng = memoList.length;
                for (let i = 0; i < memoListLeng; i++) {
                    $("#list").append("<li id='memo" + i + "'>" + memoList[i].regdate + "<br />" + memoList[i].subject + "<input class='deleteBtn' type='button' value='delete'/></li>");
                }
                if (memoListLeng > 0) {
                    const latestMemo = memoList[memoListLeng - 1];
                    $("#h1Text").text(latestMemo.regdate);
                    $("#h2Text").text(latestMemo.subject);
                    $("#h3Text").text(latestMemo.content);
                } else {
                    $("#h1Text").empty();
                    $("#h2Text").empty();
                    $("#h3Text").empty();
                }
            }
        });
    </script>
</body>
</html>
